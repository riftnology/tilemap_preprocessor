<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data and Serialization - KonvaJS Documentation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            background: #f0f0f0;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Monaco', 'Consolas', monospace;
        }
        pre code {
            background: none;
            padding: 0;
        }
        .source-url {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 10px;
            margin: 20px 0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="source-url">
        <strong>Source:</strong> <a href="https://konvajs.org/docs/data_and_serialization/Best_Practices.html" target="_blank">https://konvajs.org/docs/data_and_serialization/Best_Practices.html</a>
    </div>
    <article><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-the-best-way-to-saveload-full-stage-content-and-how-to-implement-undoredo">What is the best way to save/load full stage content and how to implement undo/redo?<a aria-label="Direct link to What is the best way to save/load full stage content and how to implement undo/redo?" class="hash-link" href="https://konvajs.org/docs/data_and_serialization/Best_Practices.html#what-is-the-best-way-to-saveload-full-stage-content-and-how-to-implement-undoredo" title="Direct link to What is the best way to save/load full stage content and how to implement undo/redo?">â€‹</a></h2>
<p>If you want to save/load simple canvas content you can use the built-in <code>Konva</code> methods: <code>node.toJSON()</code> and <code>Node.create(json)</code>.
See <a href="https://konvajs.org/docs/data_and_serialization/Simple_Load.html">simple</a> and <a href="https://konvajs.org/docs/data_and_serialization/Complex_Load.html">complex</a> demos.</p>
<p>But those methods are useful only in very small apps. In bigger apps it is VERY hard to use those methods. Why? Because the tree structure is usually very complex in larger apps, you may have a lot of event listeners, images, filters, etc. That data is not serializable into JSON (or it is very hard to do that).</p>
<p>Also it is very common that nodes in a tree have a lot information that is not directly related to the state of your app, but just used to describe visual view of your app.</p>
<p>For instance, let's think we have a game, that draws several balls in canvas. The balls are not just circles, but the complex visual groups of objects with shadows and texts inside them (like "Made in China"). Now let's think you want to serialize state of your app and use it somewhere else. Like send to another computer or implement undo/redo. Almost all the visual information (shadows, texts, sizes) is not critical and may be you don't need to save it. Because all balls have the same shadows, sizes, etc. But what is critical? In that case it is just a number of balls and their coordinates. You need to save/load only that information. It will be just a simple array:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa" tabindex="0"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> state </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">x</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">y</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">x</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">160</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">y</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1041</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><br/></span></code></pre><div class="buttonGroup__atx"><button aria-label="Copy code to clipboard" class="clean-btn" title="Copy" type="button"><span aria-hidden="true" class="copyButtonIcons_eSgA"><svg class="copyButtonIcon_y97N" viewbox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z" fill="currentColor"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewbox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z" fill="currentColor"></path></svg></span></button></div></div></div>
<p>Now when you have that information, you need to have a function, that can create the whole canvas structure.
If you want to update your canvas, for instance, you want to create a new ball, you don't need to create a new canvas node directly (like creating new instance of <code>Konva.Circle</code>), you just need to push a new object into a state and update (or recreate) canvas.</p>
<p>In that case you don't need to care about image loading, filters, event listeners, etc in saving/loading phases. Because you do all these actions in your <code>create</code> or <code>update</code> functions.</p>
<p>You would better understand what I am talking about if you know how many modern frameworks work (like <code>React</code>, <code>Vue</code>, <code>Angular</code> and many other).</p>
<p>Also take a look into these demos to have a better idea:</p>
<ol>
<li><a href="https://konvajs.org/docs/react/Undo-Redo.html">Undo/redo with react</a></li>
<li><a href="https://konvajs.org/docs/vue/Save-Load.html">Save/load with Vue</a></li>
</ol>
<p>How to implement that <code>create</code> and <code>update</code> functions? It depends. From my point of view it will be easier to use frameworks that can do that job for you, like <a href="https://konvajs.org/docs/react/index.html">react-konva</a>.</p>
<p>If you don't want to use such frameworks you need to think in terms of your own app. Here I will try to make a small demo to give you an idea.</p>
<p>The super naive method is to implement just one function <code>create(state)</code> that will do all the complex job of loading.
If you have some changes in your app you just need to destroy the canvas and create a new one. But the drawback of such approach is possibly a bad performance.</p>
<p>A bit smarter implementation is to create two functions <code>create(state)</code> and <code>update(state)</code>. <code>create</code> will make instances of all required objects, attach events and load images. <code>update</code> will update properties of nodes. If number of objects is changed - destroy all and create from scratch. If only some properties changed - call <code>update</code>.</p>
<p><strong>Instructions:</strong> In that demo we will have a bunch of images with filters, and you can add more, move them, apply a new filter by clicking on images and use undo/redo.</p>
<!-- -->
<div class="tabs-container tabList__CuJ"><ul aria-orientation="horizontal" class="tabs" role="tablist"><li aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active" role="tab" tabindex="0">Vanilla</li><li aria-selected="false" class="tabs__item tabItem_LNqP" role="tab" tabindex="-1">React</li><li aria-selected="false" class="tabs__item tabItem_LNqP" role="tab" tabindex="-1">Vue</li></ul><div class="margin-top--md"><div class="tabItem_Ymn6" role="tabpanel"><div class="light sp-c-fVPbOs sp-c-fVPbOs-gMQIch-variant-light sp-wrapper"><div class="sp-c-ikJbEZ sp-layout"><div class="sp-c-euXojQ sp-editor sp-stack" style="height:400px;flex-grow:50;flex-shrink:50;flex-basis:0;overflow:hidden"><div class="sp-c-dyHYiL sp-tabs" translate="no"><div aria-label="Select active file" class="sp-c-gGbYbQ sp-tabs-scrollable-container" role="tablist"><div aria-controls="/index.html-:R1mha7d6laqh:-tab-panel" aria-selected="false" class="sp-c-hluGOI sp-tab-container" role="tab"><button class="sp-c-bxeRRt sp-c-pacmO sp-tab-button" data-active="false" id="/index.html-:R1mha7d6laqh:-tab" tabindex="-1" title="/index.html" type="button">index.html</button></div><div aria-controls="/index.js-:R1mha7d6laqh:-tab-panel" aria-selected="true" class="sp-c-hluGOI sp-tab-container" role="tab"><button class="sp-c-bxeRRt sp-c-pacmO sp-tab-button" data-active="true" id="/index.js-:R1mha7d6laqh:-tab" tabindex="0" title="/index.js" type="button">index.js</button></div></div></div><div aria-labelledby="/index.js-:R1mha7d6laqh:-tab" class="sp-c-gtcpyq sp-code-editor" id="/index.js-:R1mha7d6laqh:-tab-panel" role="tabpanel"><div aria-autocomplete="list" aria-label="Code Editor for index.js" aria-multiline="true" class="sp-pristine sp-javascript sp-c-jOWzsE sp-c-jkvvao sp-cm" role="textbox" tabindex="0" translate="no"><pre class="sp-c-fWymNx sp-pre-placeholder" style="margin-left:var(--sp-space-5)"><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-plain">Konva</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">'konva'</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-comment">// Initial state</span>
<span class="sp-syntax-keyword">let</span> <span class="sp-syntax-plain">state</span> = <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-property">images</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-punctuation">[</span>
    <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">50</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">50</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">filter</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'none'</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">150</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">50</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">filter</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'blur'</span> <span class="sp-syntax-punctuation">}</span>
  <span class="sp-syntax-punctuation">]</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-comment">// History for undo/redo</span>
<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">history</span> = <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">JSON</span>.<span class="sp-syntax-property">stringify</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">state</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-keyword">let</span> <span class="sp-syntax-plain">historyStep</span> = <span class="sp-syntax-static">0</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">stage</span> = <span class="sp-syntax-keyword">new</span> <span class="sp-syntax-plain">Konva</span>.<span class="sp-syntax-property">Stage</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-property">container</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'container'</span><span class="sp-syntax-punctuation">,</span>
  <span class="sp-syntax-property">width</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">window</span>.<span class="sp-syntax-property">innerWidth</span><span class="sp-syntax-punctuation">,</span>
  <span class="sp-syntax-property">height</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">window</span>.<span class="sp-syntax-property">innerHeight</span><span class="sp-syntax-punctuation">,</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">layer</span> = <span class="sp-syntax-keyword">new</span> <span class="sp-syntax-plain">Konva</span>.<span class="sp-syntax-property">Layer</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">stage</span>.<span class="sp-syntax-property">add</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">layer</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-comment">// Create container</span>
<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">container</span> = <span class="sp-syntax-plain">document</span>.<span class="sp-syntax-property">createElement</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">'div'</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">container</span>.<span class="sp-syntax-property">style</span>.<span class="sp-syntax-property">position</span> = <span class="sp-syntax-string">'relative'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">document</span>.<span class="sp-syntax-property">body</span>.<span class="sp-syntax-property">appendChild</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">container</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-comment">// Create button container</span>
<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">buttonContainer</span> = <span class="sp-syntax-plain">document</span>.<span class="sp-syntax-property">createElement</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">'div'</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">buttonContainer</span>.<span class="sp-syntax-property">style</span>.<span class="sp-syntax-property">position</span> = <span class="sp-syntax-string">'absolute'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">buttonContainer</span>.<span class="sp-syntax-property">style</span>.<span class="sp-syntax-property">top</span> = <span class="sp-syntax-string">'10px'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">buttonContainer</span>.<span class="sp-syntax-property">style</span>.<span class="sp-syntax-property">left</span> = <span class="sp-syntax-string">'10px'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">buttonContainer</span>.<span class="sp-syntax-property">style</span>.<span class="sp-syntax-property">zIndex</span> = <span class="sp-syntax-string">'10'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">container</span>.<span class="sp-syntax-property">appendChild</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">buttonContainer</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-comment">// Create UI buttons</span>
<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">addButton</span> = <span class="sp-syntax-plain">document</span>.<span class="sp-syntax-property">createElement</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">'button'</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">addButton</span>.<span class="sp-syntax-property">textContent</span> = <span class="sp-syntax-string">'Add Image'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">addButton</span>.<span class="sp-syntax-property">style</span>.<span class="sp-syntax-property">margin</span> = <span class="sp-syntax-string">'0 5px'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">buttonContainer</span>.<span class="sp-syntax-property">appendChild</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">addButton</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">undoButton</span> = <span class="sp-syntax-plain">document</span>.<span class="sp-syntax-property">createElement</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">'button'</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">undoButton</span>.<span class="sp-syntax-property">textContent</span> = <span class="sp-syntax-string">'Undo'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">undoButton</span>.<span class="sp-syntax-property">style</span>.<span class="sp-syntax-property">margin</span> = <span class="sp-syntax-string">'0 5px'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">buttonContainer</span>.<span class="sp-syntax-property">appendChild</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">undoButton</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">redoButton</span> = <span class="sp-syntax-plain">document</span>.<span class="sp-syntax-property">createElement</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">'button'</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">redoButton</span>.<span class="sp-syntax-property">textContent</span> = <span class="sp-syntax-string">'Redo'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">redoButton</span>.<span class="sp-syntax-property">style</span>.<span class="sp-syntax-property">margin</span> = <span class="sp-syntax-string">'0 5px'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">buttonContainer</span>.<span class="sp-syntax-property">appendChild</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">redoButton</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-comment">// Move stage container into our container</span>
<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">stageContainer</span> = <span class="sp-syntax-plain">document</span>.<span class="sp-syntax-property">getElementById</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">'container'</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">container</span>.<span class="sp-syntax-property">appendChild</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">stageContainer</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">stageContainer</span>.<span class="sp-syntax-property">style</span>.<span class="sp-syntax-property">position</span> = <span class="sp-syntax-string">'absolute'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">stageContainer</span>.<span class="sp-syntax-property">style</span>.<span class="sp-syntax-property">top</span> = <span class="sp-syntax-string">'0'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">stageContainer</span>.<span class="sp-syntax-property">style</span>.<span class="sp-syntax-property">left</span> = <span class="sp-syntax-string">'0'</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-comment">// Load image</span>
<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">imageObj</span> = <span class="sp-syntax-keyword">new</span> Image<span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-plain">imageObj</span>.<span class="sp-syntax-property">src</span> = <span class="sp-syntax-string">'https://konvajs.org/assets/lion.png'</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">createImage</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">imageConfig</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">image</span> = <span class="sp-syntax-keyword">new</span> <span class="sp-syntax-plain">Konva</span>.<span class="sp-syntax-property">Image</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-property">image</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">imageObj</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">imageConfig</span>.<span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">imageConfig</span>.<span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-property">width</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">100</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-property">height</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">100</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-property">draggable</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">true</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">imageConfig</span>.<span class="sp-syntax-property">filter</span> === <span class="sp-syntax-string">'blur'</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-plain">image</span>.<span class="sp-syntax-property">filters</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">Konva</span>.<span class="sp-syntax-property">Filters</span>.<span class="sp-syntax-property">Blur</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-plain">image</span>.<span class="sp-syntax-property">blurRadius</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">10</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span>

  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-plain">image</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span>

<span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">create</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">state</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-plain">layer</span>.<span class="sp-syntax-property">destroyChildren</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  
  <span class="sp-syntax-plain">state</span>.<span class="sp-syntax-property">images</span>.<span class="sp-syntax-property">forEach</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">imgConfig</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">image</span> = <span class="sp-syntax-definition">createImage</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">imgConfig</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    
    <span class="sp-syntax-plain">image</span>.<span class="sp-syntax-property">on</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">'dragend'</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
      <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">pos</span> = <span class="sp-syntax-plain">image</span>.<span class="sp-syntax-property">position</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
      <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">index</span> = <span class="sp-syntax-plain">layer</span>.<span class="sp-syntax-property">children</span>.<span class="sp-syntax-property">indexOf</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">image</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
      <span class="sp-syntax-plain">state</span>.<span class="sp-syntax-property">images</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-punctuation">{</span>
        <span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">state</span>.<span class="sp-syntax-property">images</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">,</span>
        <span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">pos</span>.<span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">,</span>
        <span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">pos</span>.<span class="sp-syntax-property">y</span>
      <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>
      <span class="sp-syntax-definition">saveHistory</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

    <span class="sp-syntax-plain">image</span>.<span class="sp-syntax-property">on</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">'click'</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
      <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">index</span> = <span class="sp-syntax-plain">layer</span>.<span class="sp-syntax-property">children</span>.<span class="sp-syntax-property">indexOf</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">image</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
      <span class="sp-syntax-plain">state</span>.<span class="sp-syntax-property">images</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-punctuation">{</span>
        <span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">state</span>.<span class="sp-syntax-property">images</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">,</span>
        <span class="sp-syntax-property">filter</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">state</span>.<span class="sp-syntax-property">images</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span>.<span class="sp-syntax-property">filter</span> === <span class="sp-syntax-string">'none'</span> ? <span class="sp-syntax-string">'blur'</span> : <span class="sp-syntax-string">'none'</span>
      <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>
      <span class="sp-syntax-definition">saveHistory</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
      <span class="sp-syntax-definition">create</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">state</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

    <span class="sp-syntax-plain">layer</span>.<span class="sp-syntax-property">add</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">image</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span>

<span class="sp-syntax-keyword">function</span> <span class="sp-syntax-definition">saveHistory</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-plain">historyStep</span>++<span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">history</span>.<span class="sp-syntax-property">length</span> = <span class="sp-syntax-plain">historyStep</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">history</span>.<span class="sp-syntax-property">push</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">JSON</span>.<span class="sp-syntax-property">stringify</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">state</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span>

<span class="sp-syntax-comment">// Add event listeners</span>
<span class="sp-syntax-plain">addButton</span>.<span class="sp-syntax-property">addEventListener</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">'click'</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-plain">state</span>.<span class="sp-syntax-property">images</span>.<span class="sp-syntax-property">push</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">Math</span>.<span class="sp-syntax-property">random</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> * <span class="sp-syntax-plain">stage</span>.<span class="sp-syntax-property">width</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">Math</span>.<span class="sp-syntax-property">random</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> * <span class="sp-syntax-plain">stage</span>.<span class="sp-syntax-property">height</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-property">filter</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'none'</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-definition">saveHistory</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-definition">create</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">state</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-plain">undoButton</span>.<span class="sp-syntax-property">addEventListener</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">'click'</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">historyStep</span> === <span class="sp-syntax-static">0</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-keyword">return</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">historyStep</span>--<span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">state</span> = <span class="sp-syntax-plain">JSON</span>.<span class="sp-syntax-property">parse</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">history</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">historyStep</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-definition">create</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">state</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-plain">redoButton</span>.<span class="sp-syntax-property">addEventListener</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">'click'</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">historyStep</span> === <span class="sp-syntax-plain">history</span>.<span class="sp-syntax-property">length</span> - <span class="sp-syntax-static">1</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-keyword">return</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">historyStep</span>++<span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">state</span> = <span class="sp-syntax-plain">JSON</span>.<span class="sp-syntax-property">parse</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">history</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">historyStep</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-definition">create</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">state</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-plain">imageObj</span>.<span class="sp-syntax-property">onload</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-definition">create</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">state</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

</pre></div></div></div><div class="sp-c-gvjhpQ sp-c-gvjhpQ-xpXQZ-direction-horizontal sp-resize-handler" data-direction="horizontal" style="left:calc(50% - 5px)"></div><div class="sp-c-euXojQ sp-preview sp-stack" style="flex-grow:50;flex-shrink:50;flex-basis:0;width:50%;gap:0;height:400px"><div class="sp-c-juMdfR sp-preview-container"><iframe class="sp-c-fgviib sp-preview-iframe" title="Sandpack Preview"></iframe><div class="sp-c-kwibBT sp-preview-actions"><a class="sp-icon-standalone sp-c-bxeRRt sp-c-gMfcns sp-c-dEbKhQ sp-button" href="https://codesandbox.io/api/v1/sandboxes/define?undefined&amp;environment=parcel" rel="noreferrer noopener" target="_blank" title="Open in CodeSandbox"><svg fill="none" height="16" stroke="currentColor" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><title>Open on CodeSandbox</title><path d="M6.66665 3.33337H4.33331C3.78103 3.33337 3.33331 3.78109 3.33331 4.33337V11.6667C3.33331 12.219 3.78103 12.6667 4.33331 12.6667H11.6666C12.2189 12.6667 12.6666 12.219 12.6666 11.6667V9.33337" stroke-linecap="round"></path><path d="M10 3.33337H12.5667C12.6219 3.33337 12.6667 3.37815 12.6667 3.43337V6.00004" stroke-linecap="round"></path><path d="M7.33331 8.66668L12.5333 3.46667" stroke-linecap="round"></path></svg><span>Open Sandbox</span></a></div></div></div></div></div></div><div class="tabItem_Ymn6" hidden="" role="tabpanel"><div class="light sp-c-fVPbOs sp-c-fVPbOs-gMQIch-variant-light sp-wrapper"><div class="sp-c-ikJbEZ sp-layout"><div class="sp-c-euXojQ sp-editor sp-stack" style="height:400px;flex-grow:50;flex-shrink:50;flex-basis:0;overflow:hidden"><div aria-labelledby="/App.js-:R1qha7d6laqh:-tab" class="sp-c-gtcpyq sp-code-editor" id="/App.js-:R1qha7d6laqh:-tab-panel" role="tabpanel"><div aria-autocomplete="list" aria-label="Code Editor for App.js" aria-multiline="true" class="sp-pristine sp-javascript sp-c-jOWzsE sp-c-jkvvao sp-cm" role="textbox" tabindex="0" translate="no"><pre class="sp-c-fWymNx sp-pre-placeholder" style="margin-left:var(--sp-space-5)"><span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">Stage</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">Layer</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">Image</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">'react-konva'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">useState</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">useEffect</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">'react'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-keyword">import</span> <span class="sp-syntax-plain">useImage</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">'use-image'</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">App</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">images</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setImages</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span>
    <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">50</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">50</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">filter</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'none'</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">150</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">50</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">filter</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'blur'</span> <span class="sp-syntax-punctuation">}</span>
  <span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">history</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setHistory</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">historyStep</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">setHistoryStep</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useState</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">0</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">lionImage</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useImage</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">'https://konvajs.org/assets/lion.png'</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-string">'anonymous'</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-definition">useEffect</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">lionImage</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
      <span class="sp-syntax-definition">setHistory</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">JSON</span>.<span class="sp-syntax-property">stringify</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">images</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-punctuation">}</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">lionImage</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">handleDragEnd</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">e</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">newImages</span> = <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">images</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-punctuation">{</span>
      <span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">,</span>
      <span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">e</span>.<span class="sp-syntax-property">target</span>.<span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">,</span>
      <span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">e</span>.<span class="sp-syntax-property">target</span>.<span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span>
    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-definition">setImages</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-definition">saveHistory</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">handleClick</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">newImages</span> = <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">images</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-punctuation">{</span>
      <span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">,</span>
      <span class="sp-syntax-property">filter</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span>.<span class="sp-syntax-property">filter</span> === <span class="sp-syntax-string">'none'</span> ? <span class="sp-syntax-string">'blur'</span> : <span class="sp-syntax-string">'none'</span>
    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-definition">setImages</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-definition">saveHistory</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">saveHistory</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">newHistory</span> = <span class="sp-syntax-plain">history</span>.<span class="sp-syntax-property">slice</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">0</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">historyStep</span> + <span class="sp-syntax-static">1</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-plain">newHistory</span>.<span class="sp-syntax-property">push</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">JSON</span>.<span class="sp-syntax-property">stringify</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-definition">setHistory</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newHistory</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-definition">setHistoryStep</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newHistory</span>.<span class="sp-syntax-property">length</span> - <span class="sp-syntax-static">1</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">handleAdd</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">newImages</span> = <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">images</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">{</span>
      <span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">Math</span>.<span class="sp-syntax-property">random</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> * <span class="sp-syntax-plain">window</span>.<span class="sp-syntax-property">innerWidth</span><span class="sp-syntax-punctuation">,</span>
      <span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">Math</span>.<span class="sp-syntax-property">random</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> * <span class="sp-syntax-plain">window</span>.<span class="sp-syntax-property">innerHeight</span><span class="sp-syntax-punctuation">,</span>
      <span class="sp-syntax-property">filter</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'none'</span>
    <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-definition">setImages</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-definition">saveHistory</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">handleUndo</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">historyStep</span> === <span class="sp-syntax-static">0</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-keyword">return</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">newStep</span> = <span class="sp-syntax-plain">historyStep</span> - <span class="sp-syntax-static">1</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-definition">setHistoryStep</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newStep</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-definition">setImages</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">JSON</span>.<span class="sp-syntax-property">parse</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">history</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">newStep</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">handleRedo</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">historyStep</span> === <span class="sp-syntax-plain">history</span>.<span class="sp-syntax-property">length</span> - <span class="sp-syntax-static">1</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-keyword">return</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">newStep</span> = <span class="sp-syntax-plain">historyStep</span> + <span class="sp-syntax-static">1</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-definition">setHistoryStep</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newStep</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
    <span class="sp-syntax-definition">setImages</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">JSON</span>.<span class="sp-syntax-property">parse</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">history</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">newStep</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

  <span class="sp-syntax-keyword">return</span> <span class="sp-syntax-punctuation">(</span>
    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">div</span> <span class="sp-syntax-property">style</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">position</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'relative'</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">div</span> <span class="sp-syntax-property">style</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">{</span> 
        <span class="sp-syntax-property">position</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'absolute'</span><span class="sp-syntax-punctuation">,</span> 
        <span class="sp-syntax-property">top</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">10</span><span class="sp-syntax-punctuation">,</span> 
        <span class="sp-syntax-property">left</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">10</span><span class="sp-syntax-punctuation">,</span> 
        <span class="sp-syntax-property">zIndex</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">10</span> 
      <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span>
        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">button</span> <span class="sp-syntax-property">style</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">margin</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'0 5px'</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-property">onClick</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">handleAdd</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span>Add Image<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">button</span><span class="sp-syntax-punctuation">&gt;</span>
        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">button</span> <span class="sp-syntax-property">style</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">margin</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'0 5px'</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-property">onClick</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">handleUndo</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span>Undo<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">button</span><span class="sp-syntax-punctuation">&gt;</span>
        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-tag">button</span> <span class="sp-syntax-property">style</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">margin</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'0 5px'</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-property">onClick</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">handleRedo</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span>Redo<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">button</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">div</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">Stage</span> <span class="sp-syntax-property">width</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">window</span>.<span class="sp-syntax-property">innerWidth</span><span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-property">height</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">window</span>.<span class="sp-syntax-property">innerHeight</span><span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">&gt;</span>
        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">Layer</span><span class="sp-syntax-punctuation">&gt;</span>
          <span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">lionImage</span> &amp;&amp; <span class="sp-syntax-plain">images</span>.<span class="sp-syntax-property">map</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">img</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">i</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">(</span>
            <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">Image</span>
              <span class="sp-syntax-property">key</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">i</span><span class="sp-syntax-punctuation">}</span>
              <span class="sp-syntax-property">image</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">lionImage</span><span class="sp-syntax-punctuation">}</span>
              <span class="sp-syntax-property">x</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">img</span>.<span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">}</span>
              <span class="sp-syntax-property">y</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">img</span>.<span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">}</span>
              <span class="sp-syntax-property">width</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-static">100</span><span class="sp-syntax-punctuation">}</span>
              <span class="sp-syntax-property">height</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-static">100</span><span class="sp-syntax-punctuation">}</span>
              <span class="sp-syntax-property">draggable</span>
              <span class="sp-syntax-property">filters</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">img</span>.<span class="sp-syntax-property">filter</span> === <span class="sp-syntax-string">'blur'</span> ? <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">Konva</span>.<span class="sp-syntax-property">Filters</span>.<span class="sp-syntax-property">Blur</span><span class="sp-syntax-punctuation">]</span> : <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">}</span>
              <span class="sp-syntax-property">blurRadius</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-plain">img</span>.<span class="sp-syntax-property">filter</span> === <span class="sp-syntax-string">'blur'</span> ? <span class="sp-syntax-static">10</span> : <span class="sp-syntax-static">0</span><span class="sp-syntax-punctuation">}</span>
              <span class="sp-syntax-property">onDragEnd</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">e</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-definition">handleDragEnd</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">i</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">e</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">}</span>
              <span class="sp-syntax-property">onClick</span>=<span class="sp-syntax-punctuation">{</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-definition">handleClick</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">i</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">}</span>
            <span class="sp-syntax-punctuation">/&gt;</span>
          <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">}</span>
        <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">Layer</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">Stage</span><span class="sp-syntax-punctuation">&gt;</span>
    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-tag">div</span><span class="sp-syntax-punctuation">&gt;</span>
  <span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">export</span> <span class="sp-syntax-keyword">default</span> <span class="sp-syntax-plain">App</span><span class="sp-syntax-punctuation">;</span>

</pre></div></div></div><div class="sp-c-gvjhpQ sp-c-gvjhpQ-xpXQZ-direction-horizontal sp-resize-handler" data-direction="horizontal" style="left:calc(50% - 5px)"></div><div class="sp-c-euXojQ sp-preview sp-stack" style="flex-grow:50;flex-shrink:50;flex-basis:0;width:50%;gap:0;height:400px"><div class="sp-c-juMdfR sp-preview-container"><iframe class="sp-c-fgviib sp-preview-iframe" title="Sandpack Preview"></iframe><div class="sp-c-kwibBT sp-preview-actions"><a class="sp-icon-standalone sp-c-bxeRRt sp-c-gMfcns sp-c-dEbKhQ sp-button" href="https://codesandbox.io/api/v1/sandboxes/define?undefined&amp;environment=create-react-app" rel="noreferrer noopener" target="_blank" title="Open in CodeSandbox"><svg fill="none" height="16" stroke="currentColor" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><title>Open on CodeSandbox</title><path d="M6.66665 3.33337H4.33331C3.78103 3.33337 3.33331 3.78109 3.33331 4.33337V11.6667C3.33331 12.219 3.78103 12.6667 4.33331 12.6667H11.6666C12.2189 12.6667 12.6666 12.219 12.6666 11.6667V9.33337" stroke-linecap="round"></path><path d="M10 3.33337H12.5667C12.6219 3.33337 12.6667 3.37815 12.6667 3.43337V6.00004" stroke-linecap="round"></path><path d="M7.33331 8.66668L12.5333 3.46667" stroke-linecap="round"></path></svg><span>Open Sandbox</span></a></div></div></div></div></div></div><div class="tabItem_Ymn6" hidden="" role="tabpanel"><div class="light sp-c-fVPbOs sp-c-fVPbOs-gMQIch-variant-light sp-wrapper"><div class="sp-c-ikJbEZ sp-layout"><div class="sp-c-euXojQ sp-editor sp-stack" style="height:400px;flex-grow:50;flex-shrink:50;flex-basis:0;overflow:hidden"><div class="sp-c-dyHYiL sp-tabs" translate="no"><div aria-label="Select active file" class="sp-c-gGbYbQ sp-tabs-scrollable-container" role="tablist"><div aria-controls="/src/App.vue-:R1uha7d6laqh:-tab-panel" aria-selected="true" class="sp-c-hluGOI sp-tab-container" role="tab"><button class="sp-c-bxeRRt sp-c-pacmO sp-tab-button" data-active="true" id="/src/App.vue-:R1uha7d6laqh:-tab" tabindex="0" title="/src/App.vue" type="button">App.vue</button></div><div aria-controls="/src/main.js-:R1uha7d6laqh:-tab-panel" aria-selected="false" class="sp-c-hluGOI sp-tab-container" role="tab"><button class="sp-c-bxeRRt sp-c-pacmO sp-tab-button" data-active="false" id="/src/main.js-:R1uha7d6laqh:-tab" tabindex="-1" title="/src/main.js" type="button">main.js</button></div></div></div><div aria-labelledby="/src/App.vue-:R1uha7d6laqh:-tab" class="sp-c-gtcpyq sp-code-editor" id="/src/App.vue-:R1uha7d6laqh:-tab-panel" role="tabpanel"><div aria-autocomplete="list" aria-label="Code Editor for App.vue" aria-multiline="true" class="sp-pristine sp-html sp-c-jOWzsE sp-c-jkvvao sp-cm" role="textbox" tabindex="0" translate="no"><pre class="sp-c-fWymNx sp-pre-placeholder" style="margin-left:var(--sp-space-5)"><span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">template</span><span class="sp-syntax-punctuation">&gt;</span>
  <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">div</span> <span class="sp-syntax-property">style</span>=<span class="sp-syntax-string">"</span><span class="sp-syntax-property">position</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">relative</span><span class="sp-syntax-string">"</span><span class="sp-syntax-punctuation">&gt;</span>
    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">div</span> <span class="sp-syntax-property">style</span>=<span class="sp-syntax-string">"</span><span class="sp-syntax-property">position</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">absolute</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-property">top</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">10</span><span class="sp-syntax-keyword">px</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-property">left</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">10</span><span class="sp-syntax-keyword">px</span><span class="sp-syntax-punctuation">;</span> <span class="sp-syntax-property">z-index</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">10</span><span class="sp-syntax-string">"</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">button</span> <span class="sp-syntax-property">style</span>=<span class="sp-syntax-string">"</span><span class="sp-syntax-property">margin</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">0</span> <span class="sp-syntax-static">5</span><span class="sp-syntax-keyword">px</span><span class="sp-syntax-string">"</span> <span class="sp-syntax-property">@click</span>=<span class="sp-syntax-string">"handleAdd"</span><span class="sp-syntax-punctuation">&gt;</span>Add Image<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">button</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">button</span> <span class="sp-syntax-property">style</span>=<span class="sp-syntax-string">"</span><span class="sp-syntax-property">margin</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">0</span> <span class="sp-syntax-static">5</span><span class="sp-syntax-keyword">px</span><span class="sp-syntax-string">"</span> <span class="sp-syntax-property">@click</span>=<span class="sp-syntax-string">"handleUndo"</span><span class="sp-syntax-punctuation">&gt;</span>Undo<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">button</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">button</span> <span class="sp-syntax-property">style</span>=<span class="sp-syntax-string">"</span><span class="sp-syntax-property">margin</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">0</span> <span class="sp-syntax-static">5</span><span class="sp-syntax-keyword">px</span><span class="sp-syntax-string">"</span> <span class="sp-syntax-property">@click</span>=<span class="sp-syntax-string">"handleRedo"</span><span class="sp-syntax-punctuation">&gt;</span>Redo<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">button</span><span class="sp-syntax-punctuation">&gt;</span>
    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">div</span><span class="sp-syntax-punctuation">&gt;</span>
    <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">v-stage</span> <span class="sp-syntax-property">:config</span>=<span class="sp-syntax-string">"stageSize"</span><span class="sp-syntax-punctuation">&gt;</span>
      <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">v-layer</span><span class="sp-syntax-punctuation">&gt;</span>
        <span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">v-image</span>
          <span class="sp-syntax-property">v-for</span>=<span class="sp-syntax-string">"(img, i) in images"</span>
          <span class="sp-syntax-property">:key</span>=<span class="sp-syntax-string">"i"</span>
          <span class="sp-syntax-property">:config</span>=<span class="sp-syntax-string">"getImageConfig(img)"</span>
          <span class="sp-syntax-property">@dragend</span>=<span class="sp-syntax-string">"handleDragEnd(i, $event)"</span>
          <span class="sp-syntax-property">@click</span>=<span class="sp-syntax-string">"handleClick(i)"</span>
        <span class="sp-syntax-punctuation">/&gt;</span>
      <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">v-layer</span><span class="sp-syntax-punctuation">&gt;</span>
    <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">v-stage</span><span class="sp-syntax-punctuation">&gt;</span>
  <span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">div</span><span class="sp-syntax-punctuation">&gt;</span>
<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">template</span><span class="sp-syntax-punctuation">&gt;</span>

<span class="sp-syntax-punctuation">&lt;</span><span class="sp-syntax-definition">script</span> <span class="sp-syntax-property">setup</span><span class="sp-syntax-punctuation">&gt;</span>
<span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">ref</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">computed</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">'vue'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-keyword">import</span> <span class="sp-syntax-plain">Konva</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">'konva'</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-keyword">import</span> <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-plain">useImage</span> <span class="sp-syntax-punctuation">}</span> <span class="sp-syntax-keyword">from</span> <span class="sp-syntax-string">'vue-konva'</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">stageSize</span> = <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-property">width</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">window</span>.<span class="sp-syntax-property">innerWidth</span><span class="sp-syntax-punctuation">,</span>
  <span class="sp-syntax-property">height</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">window</span>.<span class="sp-syntax-property">innerHeight</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">images</span> = <span class="sp-syntax-definition">ref</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span>
  <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">50</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">50</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">filter</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'none'</span> <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">,</span>
  <span class="sp-syntax-punctuation">{</span> <span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">150</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">50</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-property">filter</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'blur'</span> <span class="sp-syntax-punctuation">}</span>
<span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">history</span> = <span class="sp-syntax-definition">ref</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">historyStep</span> = <span class="sp-syntax-definition">ref</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">0</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">lionImage</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-definition">useImage</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-string">'https://konvajs.org/assets/lion.png'</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-string">'anonymous'</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">getImageConfig</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">img</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-property">image</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">lionImage</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">,</span>
  <span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">img</span>.<span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">,</span>
  <span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">img</span>.<span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">,</span>
  <span class="sp-syntax-property">width</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">100</span><span class="sp-syntax-punctuation">,</span>
  <span class="sp-syntax-property">height</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">100</span><span class="sp-syntax-punctuation">,</span>
  <span class="sp-syntax-property">draggable</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-static">true</span><span class="sp-syntax-punctuation">,</span>
  <span class="sp-syntax-property">filters</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">img</span>.<span class="sp-syntax-property">filter</span> === <span class="sp-syntax-string">'blur'</span> ? <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">Konva</span>.<span class="sp-syntax-property">Filters</span>.<span class="sp-syntax-property">Blur</span><span class="sp-syntax-punctuation">]</span> : <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">,</span>
  <span class="sp-syntax-property">blurRadius</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">img</span>.<span class="sp-syntax-property">filter</span> === <span class="sp-syntax-string">'blur'</span> ? <span class="sp-syntax-static">10</span> : <span class="sp-syntax-static">0</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">saveHistory</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">newHistory</span> = <span class="sp-syntax-plain">history</span>.<span class="sp-syntax-property">value</span>.<span class="sp-syntax-property">slice</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-static">0</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">historyStep</span>.<span class="sp-syntax-property">value</span> + <span class="sp-syntax-static">1</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">newHistory</span>.<span class="sp-syntax-property">push</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">JSON</span>.<span class="sp-syntax-property">stringify</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">history</span>.<span class="sp-syntax-property">value</span> = <span class="sp-syntax-plain">newHistory</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">historyStep</span>.<span class="sp-syntax-property">value</span> = <span class="sp-syntax-plain">newHistory</span>.<span class="sp-syntax-property">length</span> - <span class="sp-syntax-static">1</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">handleDragEnd</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-plain">e</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">newImages</span> = <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">images</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">pos</span> = <span class="sp-syntax-plain">e</span>.<span class="sp-syntax-property">target</span>.<span class="sp-syntax-property">position</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">pos</span>.<span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">pos</span>.<span class="sp-syntax-property">y</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">images</span>.<span class="sp-syntax-property">value</span> = <span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-definition">saveHistory</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">handleClick</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">newImages</span> = <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">images</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span> = <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-property">filter</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">index</span><span class="sp-syntax-punctuation">]</span>.<span class="sp-syntax-property">filter</span> === <span class="sp-syntax-string">'none'</span> ? <span class="sp-syntax-string">'blur'</span> : <span class="sp-syntax-string">'none'</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">images</span>.<span class="sp-syntax-property">value</span> = <span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-definition">saveHistory</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">handleAdd</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">newImages</span> = <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-punctuation">...</span><span class="sp-syntax-plain">images</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">,</span> <span class="sp-syntax-punctuation">{</span>
    <span class="sp-syntax-property">x</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">Math</span>.<span class="sp-syntax-property">random</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> * <span class="sp-syntax-plain">window</span>.<span class="sp-syntax-property">innerWidth</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-property">y</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-plain">Math</span>.<span class="sp-syntax-property">random</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> * <span class="sp-syntax-plain">window</span>.<span class="sp-syntax-property">innerHeight</span><span class="sp-syntax-punctuation">,</span>
    <span class="sp-syntax-property">filter</span><span class="sp-syntax-punctuation">:</span> <span class="sp-syntax-string">'none'</span>
  <span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">images</span>.<span class="sp-syntax-property">value</span> = <span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-definition">saveHistory</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">newImages</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">handleUndo</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">historyStep</span>.<span class="sp-syntax-property">value</span> === <span class="sp-syntax-static">0</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-keyword">return</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">historyStep</span>.<span class="sp-syntax-property">value</span>--<span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">images</span>.<span class="sp-syntax-property">value</span> = <span class="sp-syntax-plain">JSON</span>.<span class="sp-syntax-property">parse</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">history</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">historyStep</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-keyword">const</span> <span class="sp-syntax-plain">handleRedo</span> = <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">=&gt;</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">historyStep</span>.<span class="sp-syntax-property">value</span> === <span class="sp-syntax-plain">history</span>.<span class="sp-syntax-property">value</span>.<span class="sp-syntax-property">length</span> - <span class="sp-syntax-static">1</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-keyword">return</span><span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">historyStep</span>.<span class="sp-syntax-property">value</span>++<span class="sp-syntax-punctuation">;</span>
  <span class="sp-syntax-plain">images</span>.<span class="sp-syntax-property">value</span> = <span class="sp-syntax-plain">JSON</span>.<span class="sp-syntax-property">parse</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">history</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">historyStep</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span><span class="sp-syntax-punctuation">;</span>

<span class="sp-syntax-comment">// Initialize history when image is loaded</span>
<span class="sp-syntax-keyword">if</span> <span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">lionImage</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">)</span> <span class="sp-syntax-punctuation">{</span>
  <span class="sp-syntax-plain">history</span>.<span class="sp-syntax-property">value</span> = <span class="sp-syntax-punctuation">[</span><span class="sp-syntax-plain">JSON</span>.<span class="sp-syntax-property">stringify</span><span class="sp-syntax-punctuation">(</span><span class="sp-syntax-plain">images</span>.<span class="sp-syntax-property">value</span><span class="sp-syntax-punctuation">)</span><span class="sp-syntax-punctuation">]</span><span class="sp-syntax-punctuation">;</span>
<span class="sp-syntax-punctuation">}</span>
<span class="sp-syntax-punctuation">&lt;/</span><span class="sp-syntax-definition">script</span><span class="sp-syntax-punctuation">&gt;</span>

</pre></div></div></div><div class="sp-c-gvjhpQ sp-c-gvjhpQ-xpXQZ-direction-horizontal sp-resize-handler" data-direction="horizontal" style="left:calc(50% - 5px)"></div><div class="sp-c-euXojQ sp-preview sp-stack" style="flex-grow:50;flex-shrink:50;flex-basis:0;width:50%;gap:0;height:400px"><div class="sp-c-juMdfR sp-preview-container"><iframe class="sp-c-fgviib sp-preview-iframe" title="Sandpack Preview"></iframe><div class="sp-c-kwibBT sp-preview-actions"><a class="sp-icon-standalone sp-c-bxeRRt sp-c-gMfcns sp-c-dEbKhQ sp-button" href="https://codesandbox.io/api/v1/sandboxes/define?undefined&amp;environment=vue-cli" rel="noreferrer noopener" target="_blank" title="Open in CodeSandbox"><svg fill="none" height="16" stroke="currentColor" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><title>Open on CodeSandbox</title><path d="M6.66665 3.33337H4.33331C3.78103 3.33337 3.33331 3.78109 3.33331 4.33337V11.6667C3.33331 12.219 3.78103 12.6667 4.33331 12.6667H11.6666C12.2189 12.6667 12.6666 12.219 12.6666 11.6667V9.33337" stroke-linecap="round"></path><path d="M10 3.33337H12.5667C12.6219 3.33337 12.6667 3.37815 12.6667 3.43337V6.00004" stroke-linecap="round"></path><path d="M7.33331 8.66668L12.5333 3.46667" stroke-linecap="round"></path></svg><span>Open Sandbox</span></a></div></div></div></div></div></div></div></div></div></article>
</body>
</html>